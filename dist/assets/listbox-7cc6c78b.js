import{A as R,q as c,z as B,C as L,D as J,E as F,v as U,G as N,F as W,I as X,H as Y,J as I,i as Z}from"./index-bfbdc443.js";import{u as P,o as g,E as _,A as E,T as ee,t as M,N as $,a as p}from"./keyboard-16767ccf.js";import{w as te}from"./use-outside-click-10b1ef55.js";import{s as ae}from"./use-resolve-button-type-fb66ebe2.js";import{f as le,c as O,p as oe,u as ne}from"./menu-60f67901.js";import{f as ie,s as ue}from"./hidden-c8eb4dfd.js";import{t as re,i as j,l as se}from"./open-closed-84e398ab.js";import{w as ve,h as de,O as pe}from"./focus-management-2ab41560.js";function ce(t,u,i){let b=R(i==null?void 0:i.value),e=c(()=>t.value!==void 0);return[c(()=>e.value?t.value:b.value),function(d){return e.value||(b.value=d),u==null?void 0:u(d)}]}function q(t={},u=null,i=[]){for(let[b,e]of Object.entries(t))K(i,H(u,b),e);return i}function H(t,u){return t?t+"["+u+"]":u}function K(t,u,i){if(Array.isArray(i))for(let[b,e]of i.entries())K(t,H(u,b.toString()),e);else i instanceof Date?t.push([u,i.toISOString()]):typeof i=="boolean"?t.push([u,i?"1":"0"]):typeof i=="string"?t.push([u,i]):typeof i=="number"?t.push([u,`${i}`]):i==null?t.push([u,""]):q(i,u,t)}function fe(t,u){return t===u}var be=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(be||{}),me=(t=>(t[t.Single=0]="Single",t[t.Multi=1]="Multi",t))(me||{}),xe=(t=>(t[t.Pointer=0]="Pointer",t[t.Other=1]="Other",t))(xe||{});function ge(t){requestAnimationFrame(()=>requestAnimationFrame(t))}let Q=Symbol("ListboxContext");function C(t){let u=Z(Q,null);if(u===null){let i=new Error(`<${t} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,C),i}return u}let De=B({name:"Listbox",emits:{"update:modelValue":t=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],default:()=>fe},horizontal:{type:[Boolean],default:!1},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},multiple:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(t,{slots:u,attrs:i,emit:b}){let e=R(1),d=R(null),y=R(null),h=R(null),f=R([]),a=R(""),l=R(null),w=R(1);function T(o=n=>n){let n=l.value!==null?f.value[l.value]:null,r=pe(o(f.value.slice()),x=>g(x.dataRef.domRef)),v=n?r.indexOf(n):null;return v===-1&&(v=null),{options:r,activeOptionIndex:v}}let S=c(()=>t.multiple?1:0),[D,A]=ce(c(()=>t.modelValue),o=>b("update:modelValue",o),c(()=>t.defaultValue)),k=c(()=>D.value===void 0?P(S.value,{1:[],0:void 0}):D.value),s={listboxState:e,value:k,mode:S,compare(o,n){if(typeof t.by=="string"){let r=t.by;return(o==null?void 0:o[r])===(n==null?void 0:n[r])}return t.by(o,n)},orientation:c(()=>t.horizontal?"horizontal":"vertical"),labelRef:d,buttonRef:y,optionsRef:h,disabled:c(()=>t.disabled),options:f,searchQuery:a,activeOptionIndex:l,activationTrigger:w,closeListbox(){t.disabled||e.value!==1&&(e.value=1,l.value=null)},openListbox(){t.disabled||e.value!==0&&(e.value=0)},goToOption(o,n,r){if(t.disabled||e.value===1)return;let v=T(),x=le(o===O.Specific?{focus:O.Specific,id:n}:{focus:o},{resolveItems:()=>v.options,resolveActiveIndex:()=>v.activeOptionIndex,resolveId:V=>V.id,resolveDisabled:V=>V.dataRef.disabled});a.value="",l.value=x,w.value=r??1,f.value=v.options},search(o){if(t.disabled||e.value===1)return;let n=a.value!==""?0:1;a.value+=o.toLowerCase();let r=(l.value!==null?f.value.slice(l.value+n).concat(f.value.slice(0,l.value+n)):f.value).find(x=>x.dataRef.textValue.startsWith(a.value)&&!x.dataRef.disabled),v=r?f.value.indexOf(r):-1;v===-1||v===l.value||(l.value=v,w.value=1)},clearSearch(){t.disabled||e.value!==1&&a.value!==""&&(a.value="")},registerOption(o,n){let r=T(v=>[...v,{id:o,dataRef:n}]);f.value=r.options,l.value=r.activeOptionIndex},unregisterOption(o){let n=T(r=>{let v=r.findIndex(x=>x.id===o);return v!==-1&&r.splice(v,1),r});f.value=n.options,l.value=n.activeOptionIndex,w.value=1},theirOnChange(o){t.disabled||A(o)},select(o){t.disabled||A(P(S.value,{0:()=>o,1:()=>{let n=L(s.value.value).slice(),r=L(o),v=n.findIndex(x=>s.compare(r,L(x)));return v===-1?n.push(r):n.splice(v,1),n}}))}};te([y,h],(o,n)=>{var r;s.closeListbox(),ve(n,de.Loose)||(o.preventDefault(),(r=g(y))==null||r.focus())},c(()=>e.value===0)),J(Q,s),re(c(()=>P(e.value,{0:j.Open,1:j.Closed})));let m=c(()=>{var o;return(o=g(y))==null?void 0:o.closest("form")});return F(()=>{U([m],()=>{if(!m.value||t.defaultValue===void 0)return;function o(){s.theirOnChange(t.defaultValue)}return m.value.addEventListener("reset",o),()=>{var n;(n=m.value)==null||n.removeEventListener("reset",o)}},{immediate:!0})}),()=>{let{name:o,modelValue:n,disabled:r,form:v,...x}=t,V={open:e.value===0,disabled:r,value:k.value};return N(W,[...o!=null&&k.value!=null?q({[o]:k.value}).map(([z,G])=>N(ie,_({features:ue.Hidden,key:z,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:v,name:z,value:G}))):[],E({ourProps:{},theirProps:{...i,...ee(x,["defaultValue","onUpdate:modelValue","horizontal","multiple","by"])},slot:V,slots:u,attrs:i,name:"Listbox"})])}}}),Pe=B({name:"ListboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:()=>`headlessui-listbox-button-${M()}`}},setup(t,{attrs:u,slots:i,expose:b}){let e=C("ListboxButton");b({el:e.buttonRef,$el:e.buttonRef});function d(a){switch(a.key){case p.Space:case p.Enter:case p.ArrowDown:a.preventDefault(),e.openListbox(),I(()=>{var l;(l=g(e.optionsRef))==null||l.focus({preventScroll:!0}),e.value.value||e.goToOption(O.First)});break;case p.ArrowUp:a.preventDefault(),e.openListbox(),I(()=>{var l;(l=g(e.optionsRef))==null||l.focus({preventScroll:!0}),e.value.value||e.goToOption(O.Last)});break}}function y(a){switch(a.key){case p.Space:a.preventDefault();break}}function h(a){e.disabled.value||(e.listboxState.value===0?(e.closeListbox(),I(()=>{var l;return(l=g(e.buttonRef))==null?void 0:l.focus({preventScroll:!0})})):(a.preventDefault(),e.openListbox(),ge(()=>{var l;return(l=g(e.optionsRef))==null?void 0:l.focus({preventScroll:!0})})))}let f=ae(c(()=>({as:t.as,type:u.type})),e.buttonRef);return()=>{var a,l;let w={open:e.listboxState.value===0,disabled:e.disabled.value,value:e.value.value},{id:T,...S}=t,D={ref:e.buttonRef,id:T,type:f.value,"aria-haspopup":"listbox","aria-controls":(a=g(e.optionsRef))==null?void 0:a.id,"aria-expanded":e.listboxState.value===0,"aria-labelledby":e.labelRef.value?[(l=g(e.labelRef))==null?void 0:l.id,T].join(" "):void 0,disabled:e.disabled.value===!0?!0:void 0,onKeydown:d,onKeyup:y,onClick:h};return E({ourProps:D,theirProps:S,slot:w,attrs:u,slots:i,name:"ListboxButton"})}}}),ke=B({name:"ListboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-listbox-options-${M()}`}},setup(t,{attrs:u,slots:i,expose:b}){let e=C("ListboxOptions"),d=R(null);b({el:e.optionsRef,$el:e.optionsRef});function y(a){switch(d.value&&clearTimeout(d.value),a.key){case p.Space:if(e.searchQuery.value!=="")return a.preventDefault(),a.stopPropagation(),e.search(a.key);case p.Enter:if(a.preventDefault(),a.stopPropagation(),e.activeOptionIndex.value!==null){let l=e.options.value[e.activeOptionIndex.value];e.select(l.dataRef.value)}e.mode.value===0&&(e.closeListbox(),I(()=>{var l;return(l=g(e.buttonRef))==null?void 0:l.focus({preventScroll:!0})}));break;case P(e.orientation.value,{vertical:p.ArrowDown,horizontal:p.ArrowRight}):return a.preventDefault(),a.stopPropagation(),e.goToOption(O.Next);case P(e.orientation.value,{vertical:p.ArrowUp,horizontal:p.ArrowLeft}):return a.preventDefault(),a.stopPropagation(),e.goToOption(O.Previous);case p.Home:case p.PageUp:return a.preventDefault(),a.stopPropagation(),e.goToOption(O.First);case p.End:case p.PageDown:return a.preventDefault(),a.stopPropagation(),e.goToOption(O.Last);case p.Escape:a.preventDefault(),a.stopPropagation(),e.closeListbox(),I(()=>{var l;return(l=g(e.buttonRef))==null?void 0:l.focus({preventScroll:!0})});break;case p.Tab:a.preventDefault(),a.stopPropagation();break;default:a.key.length===1&&(e.search(a.key),d.value=setTimeout(()=>e.clearSearch(),350));break}}let h=se(),f=c(()=>h!==null?(h.value&j.Open)===j.Open:e.listboxState.value===0);return()=>{var a,l;let w={open:e.listboxState.value===0},{id:T,...S}=t,D={"aria-activedescendant":e.activeOptionIndex.value===null||(a=e.options.value[e.activeOptionIndex.value])==null?void 0:a.id,"aria-multiselectable":e.mode.value===1?!0:void 0,"aria-labelledby":(l=g(e.buttonRef))==null?void 0:l.id,"aria-orientation":e.orientation.value,id:T,onKeydown:y,role:"listbox",tabIndex:0,ref:e.optionsRef};return E({ourProps:D,theirProps:S,slot:w,attrs:u,slots:i,features:$.RenderStrategy|$.Static,visible:f.value,name:"ListboxOptions"})}}}),Ie=B({name:"ListboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-listbox.option-${M()}`}},setup(t,{slots:u,attrs:i,expose:b}){let e=C("ListboxOption"),d=R(null);b({el:d,$el:d});let y=c(()=>e.activeOptionIndex.value!==null?e.options.value[e.activeOptionIndex.value].id===t.id:!1),h=c(()=>P(e.mode.value,{0:()=>e.compare(L(e.value.value),L(t.value)),1:()=>L(e.value.value).some(s=>e.compare(L(s),L(t.value)))})),f=c(()=>P(e.mode.value,{1:()=>{var s;let m=L(e.value.value);return((s=e.options.value.find(o=>m.some(n=>e.compare(L(n),L(o.dataRef.value)))))==null?void 0:s.id)===t.id},0:()=>h.value})),a=oe(d),l=c(()=>({disabled:t.disabled,value:t.value,get textValue(){return a()},domRef:d}));F(()=>e.registerOption(t.id,l)),X(()=>e.unregisterOption(t.id)),F(()=>{U([e.listboxState,h],()=>{e.listboxState.value===0&&h.value&&P(e.mode.value,{1:()=>{f.value&&e.goToOption(O.Specific,t.id)},0:()=>{e.goToOption(O.Specific,t.id)}})},{immediate:!0})}),Y(()=>{e.listboxState.value===0&&y.value&&e.activationTrigger.value!==0&&I(()=>{var s,m;return(m=(s=g(d))==null?void 0:s.scrollIntoView)==null?void 0:m.call(s,{block:"nearest"})})});function w(s){if(t.disabled)return s.preventDefault();e.select(t.value),e.mode.value===0&&(e.closeListbox(),I(()=>{var m;return(m=g(e.buttonRef))==null?void 0:m.focus({preventScroll:!0})}))}function T(){if(t.disabled)return e.goToOption(O.Nothing);e.goToOption(O.Specific,t.id)}let S=ne();function D(s){S.update(s)}function A(s){S.wasMoved(s)&&(t.disabled||y.value||e.goToOption(O.Specific,t.id,0))}function k(s){S.wasMoved(s)&&(t.disabled||y.value&&e.goToOption(O.Nothing))}return()=>{let{disabled:s}=t,m={active:y.value,selected:h.value,disabled:s},{id:o,value:n,disabled:r,...v}=t,x={id:o,ref:d,role:"option",tabIndex:s===!0?void 0:-1,"aria-disabled":s===!0?!0:void 0,"aria-selected":h.value,disabled:void 0,onClick:w,onFocus:T,onPointerenter:D,onMouseenter:D,onPointermove:A,onMousemove:A,onPointerleave:k,onMouseleave:k};return E({ourProps:x,theirProps:v,slot:m,attrs:i,slots:u,name:"ListboxOption"})}}});export{ke as A,Ie as F,De as I,ce as d,q as e,Pe as j};
